@page "/chatroom"
@using BlazorEntre2Ages.Services
@using BlazorEntre2Ages.Models
@inject IMessageService MessageService

<h3>ChatRoom</h3>
@if (_messages == null)
{
    <h4>Loading...</h4>
}
else
{
    <div id="scrollbox" class="h-100">
        @foreach (var item in _messages)
        {
            <div class="@item.CSS">
                <div class="user">@item.Author</div>
                <div class="msg">@item.Body</div>
                <div class="timestamp">@epoch2string((int) item.TimeStamp)</div>
            </div>
        }
        <hr />

    </div>
    <div>
        <textarea class="input-lg" placeholder="enter your comment"></textarea>
        <button class="btn btn-default">Send</button>
    </div>
}

@code {

    IEnumerable<Message> _messages;

    protected override async Task OnInitializedAsync()
    {
        MessageService.OnChangeAsync += async mess =>
        {
            await InvokeAsync(() =>
            {
                _messages = mess;
                StateHasChanged();
            }
            );
        };
    }

    private string epoch2string(int epoch)
    {
        //return new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc).AddSeconds(epoch).ToString();
        return DateTimeOffset.FromUnixTimeSeconds(epoch).LocalDateTime.ToString();
    }

}